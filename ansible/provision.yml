---
- hosts: www
  become: yes
  gather_facts: true

  roles:
    - role: common
    - role: php
    - role: composer
    - role: apache
    - role: mysql-server
    - role: nodejs
    - role: phpmyadmin
      when: install_phpymyadmin is defined

  pre_tasks:
  - name: Install python 2.7
    raw: apt-get update -qq; apt-get install -qq python2.7

  tasks:
  # - name: Install npm packages based on package.json.
  #   npm:
  #     path: /vagrant/src/public_html/assets

  - name: restart apache
    service:
      name: apache2
      state: restarted
      enabled: yes

  # - name: Install composer packages
  #   composer:
  #     command: install
  #     working_dir: "{{ item }}"
  #   loop:
  #     - "{{ composer_working_dir }}"

  post_tasks:
    - name: open URL
      become: no
      local_action: shell open "{{ base_url }}"
      ignore_errors: yes
